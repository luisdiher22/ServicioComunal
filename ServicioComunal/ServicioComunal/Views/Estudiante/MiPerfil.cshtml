@model ServicioComunal.Models.Estudiante
@{
    ViewData["Title"] = "Mi Perfil - Estudiante";
}

<div class="container-fluid estudiante-theme">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 sidebar p-3">
            <div class="text-center mb-4">
                <img src="~/images/logo-liceo.svg" alt="Logo" style="width: 60px; height: 60px;">
                <h5 class="mt-2">@Model?.Nombre @Model?.Apellidos</h5>
                <small class="text-muted">Estudiante - @Model?.Clase</small>
            </div>

            <nav class="nav flex-column">
                <a class="nav-link" href="@Url.Action("Dashboard", "Estudiante")">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a class="nav-link" href="@Url.Action("MiGrupo", "Estudiante")">
                    <i class="fas fa-users"></i> Mi Grupo
                </a>
                <a class="nav-link" href="@Url.Action("Entregas", "Estudiante")">
                    <i class="fas fa-file-upload"></i> Entregas
                </a>
                <a class="nav-link" href="@Url.Action("MisSolicitudes", "Estudiante")">
                    <i class="fas fa-bell"></i> Solicitudes
                </a>
                <a class="nav-link active" href="@Url.Action("MiPerfil", "Estudiante")">
                    <i class="fas fa-user"></i> Mi Perfil
                </a>
                <hr>
                <a class="nav-link text-danger" href="@Url.Action("Logout", "Auth")">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </a>
            </nav>
        </div>

        <!-- Contenido principal -->
        <div class="col-md-9 main-content p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Mi Perfil</h2>
                <div class="text-muted">
                    <i class="fas fa-user"></i> Información Personal
                </div>
            </div>

            <!-- Información personal -->
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-id-card"></i> Información Personal
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Número de Identificación:</label>
                                    <p class="text-muted">@Model?.Identificacion</p>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Nombre Completo:</label>
                                    <p class="text-muted">@Model?.Nombre @Model?.Apellidos</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Clase:</label>
                                    <p class="text-muted">@Model?.Clase</p>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Estado del Usuario:</label>
                                    <p class="text-muted"><span class="badge bg-success">Activo</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <!-- Cambio de contraseña -->
                    <div class="card">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">
                                <i class="fas fa-key"></i> Cambiar Contraseña
                            </h5>
                        </div>
                        <div class="card-body">
                            <form id="formCambiarContraseña" onsubmit="cambiarContraseña(event)">
                                <div class="mb-3">
                                    <label for="contraseñaActual" class="form-label">Contraseña Actual</label>
                                    <input type="password" class="form-control" id="contraseñaActual" required>
                                </div>
                                <div class="mb-3">
                                    <label for="nuevaContraseña" class="form-label">Nueva Contraseña</label>
                                    <input type="password" class="form-control" id="nuevaContraseña" required minlength="8">
                                    <div class="form-text">Mínimo 8 caracteres, debe incluir al menos un número</div>
                                </div>
                                <div class="mb-3">
                                    <label for="confirmarContraseña" class="form-label">Confirmar Nueva Contraseña</label>
                                    <input type="password" class="form-control" id="confirmarContraseña" required>
                                </div>
                                <button type="submit" class="btn btn-warning w-100">
                                    <i class="fas fa-save"></i> Cambiar Contraseña
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Información adicional -->
                    <div class="card mt-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-info-circle"></i> Información del Sistema
                            </h5>
                        </div>
                        <div class="card-body">
                            <p><strong>Rol:</strong> Estudiante</p>
                            <p><strong>Estado:</strong> <span class="badge bg-success">Activo</span></p>
                            <p><strong>Último acceso:</strong> Ahora</p>
                            <hr>
                            <p class="text-muted small">
                                Si necesitas actualizar tu información personal, 
                                contacta con el administrador del sistema.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .sidebar {
        min-height: 100vh;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    }

    .nav-link {
        color: #333;
        padding: 0.75rem 1rem;
        margin-bottom: 0.25rem;
        border-radius: 0.375rem;
        transition: all 0.3s ease;
    }

    .nav-link:hover {
        background-color: #f8f9fa;
        color: #007bff;
        transform: translateX(5px);
    }

    .nav-link.active {
        background-color: #007bff;
        color: white;
    }

    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        border: 1px solid rgba(0, 0, 0, 0.125);
    }

    .main-content {
        background-color: #f8f9fa;
        min-height: 100vh;
    }
</style>

<script>
    function cambiarContraseña(event) {
        event.preventDefault();
        
        const contraseñaActual = document.getElementById('contraseñaActual').value;
        const nuevaContraseña = document.getElementById('nuevaContraseña').value;
        const confirmarContraseña = document.getElementById('confirmarContraseña').value;
        
        // Validaciones básicas
        if (nuevaContraseña !== confirmarContraseña) {
            alert('Las contraseñas no coinciden');
            return;
        }
        
        if (nuevaContraseña.length < 8) {
            alert('La nueva contraseña debe tener al menos 8 caracteres');
            return;
        }
        
        if (!/\d/.test(nuevaContraseña)) {
            alert('La nueva contraseña debe contener al menos un número');
            return;
        }
        
        // Enviar solicitud al servidor
        fetch('@Url.Action("CambiarContraseña", "Estudiante")', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            },
            body: JSON.stringify({
                contraseñaActual: contraseñaActual,
                nuevaContraseña: nuevaContraseña
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Contraseña cambiada exitosamente');
                document.getElementById('formCambiarContraseña').reset();
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al cambiar la contraseña');
        });
    }
</script>

@Html.AntiForgeryToken()
